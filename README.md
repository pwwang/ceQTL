# ceQTL: A co-expression QTL model to detect a variant that affects transcription factor binding and its target regulation

Expression quantitative trait locus (eQTL) mapping is used to identify the functional link between a genomic variant, and a gene’s expression. A significant eQTL association does not mean causal relationship or mechanism and further investigation is needed to understand how a SNP impacts gene expression. One of the most plausible explanations for eQTL is that a genomic variant affects transcription factor (TF) binding and thus impacts its regulation on target genes (TGs). However, current eQTL does not provide information on the TF, and how its regulation is mediated by the SNP’s genotypes. Here, we propose a new method called differential co-expression QTL (ceQTL) among different alleles using Chow statistics to specifically detect eQTLs that are bound by a particular TF. We start with building a trio of TF, its TG, and related SNP and then test the significant coefficient difference among different genotypes of the SNP.  We applied this ceQTL model to simulated data and the lung tissue datasets from the GTEx project. The simulated data results showed that the model was robust to detect true ceQTLs at variable sample sizes and different minor allele frequencies as measured by Area Under the Curve (AUC). Our tool also performed a TF binding affinity analysis to add another layer of evidence for functional interpretation. In summary, ceQTL analysis provides a more interpretable and biological insight into the mechanism of eQTL and transcriptomic regulation, which would help us better understand how genomic variants affect phenotypes and diseases.

## Installation

`ceQTL` uses [Poetry](https://python-poetry.org/) for dependency management. Please make sure you have Poetry installed.

```bash
git clone https://github.com/pwwang/ceQTL.git
cd ceQTL
poetry update && poetry install
poetry shell
```

Install R dependencies:

```R
install.packages(c("metap"))
remotes::install_github("pwwang/biopipen.utils.R")
```

## Data Preparation

See `testdata/` for example input files:

1. Quality controlled genotype data, with SNP as columns and samples as rows.
2. Expression data, with genes as columns and samples as rows.
3. TF-target file in GMT format to restrict the target genes for each TF.
4. Gene-SNP file in GMT format to restrict the SNPs for each gene.
5. The trio file limits TF-snp-gene relationship. A tab-delimited file with three columns: TF, SNP, Gene.
6. Covariate file (optional), with samples as rows and covariates as columns.

## Calling ceQTLs

```bash
# Make sure poetry environment is activated
ceqtl call \
  --geno path/to/genotype.txt \
  --expr path/to/expression.txt \
  --cov path/to/covariates.txt \
  --genesnp path/to/genesnp.gmt \
  --tftarget path/to/tftarget.gmt \
  --triofile path/to/triofile.txt \
  --ncores <number_of_cores>
```

## Calling ceQTLs with test data

```bash
ceqtl call \
    --geno testdata/sim1-gtmat.txt \
    --expr testdata/simulated_expr.txt \
    --genesnp testdata/simulated_genesnps.gmt \
    --tftarget testdata/simulated_tftargets.gmt \
    --DataPreparation.envs.transpose_geno \
    --DataPreparation.envs.transpose_expr
```

## Checking results

There are three types of results generated by ceQTL call:

1. ceQTL trios (SNP-TF-Target) results with pvalues and adjusted pvalues.
   (find in `ceqtl_call-output/CombineAndAdjustPValues/ceqtl-trios.txt`)
2. ceQTL SNP-Gene pair results with combined pvalues and adjusted pvalues (can be used to compare with eQTL results).
   (find in `ceqtl_call-output/CombinePValuesForVariantGenePairs/ceqtl-vargenes.txt`)
3. ceQTL SNP results with combined pvalues and adjusted pvalues.
   (find in `ceqtl_call-output/CombinePValuesForVariants/ceqtl-variants.txt`)
